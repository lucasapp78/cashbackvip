<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>L.A Cashback VIP ðŸ‘‘</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7; margin: 0; }
    h2 { text-align: center; color: #333; }
    label, select, input {
      display: block; width: 100%; margin-bottom: 12px;
      font-size: 1rem; padding: 10px; border-radius: 5px;
      border: 1px solid #ccc; box-sizing: border-box;
    }
    button {
      width: 100%; padding: 14px; background-color: #007BFF;
      color: white; font-size: 1.1rem; border: none;
      border-radius: 8px; margin-top: 10px; cursor: pointer;
    }
    button:hover { background-color: #0056b3; }
    .game-card {
      background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 15px; margin-bottom: 15px;
    }
    .game-title {
      font-weight: bold; margin-bottom: 6px;
    }
    .game-option {
      margin-bottom: 6px; display: flex; align-items: center;
    }
    .game-option input { margin-right: 8px; }
    .search-bar {
      margin-bottom: 15px; padding: 10px; font-size: 1rem;
      border-radius: 5px; border: 1px solid #ccc; width: 100%;
      box-sizing: border-box;
    }
    .button-group {
      display: flex; gap: 10px; margin-bottom: 10px;
    }
    .combo-card {
      background: #fff; color: #000;
      border-radius: 12px; padding: 15px; margin-bottom: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .combo-card h4 { margin: 0 0 8px 0; color: #007BFF; font-size: 1.1rem; }
    .combo-card p { margin: 4px 0; font-size: 1rem; line-height: 1.4; }
    .combo-retorno { font-weight: bold; color: green; margin-top: 8px; }
  </style>
</head>
<body>
<h2>L.A Cashback VIP ðŸ‘‘</h2>

<label for="liga">Escolha a Liga:</label>
<select id="liga">
  <option value="soccer_brazil_campeonato">BrasileirÃ£o</option>
  <option value="soccer_epl">Premier League</option>
  <option value="soccer_uefa_champs_league">Champions League</option>
  <option value="soccer_copa_libertadores">Libertadores</option>
</select>

<label for="tipoAposta">Modo de aposta:</label>
<select id="tipoAposta">
  <option value="simples">Simples (1X2)</option>
  <option value="btts">Ambas Marcam (BTTS)</option>
  <option value="over25">Mais de 2.5 Gols</option>
  <option value="under25">Menos de 2.5 Gols</option>
  <option value="placar">Placar Exato</option>
  <option value="dupla">Dupla Chance</option>
  <option value="resultado_gols">Resultado + Gols</option>
  <option value="outros">Outro Mercado</option>
</select>

<div style="display: flex; gap: 10px;">
  <div style="flex:1">
    <label for="oddMin">Odd mÃ­nima:</label>
    <input id="oddMin" step="0.01" type="number" value="1.10"/>
  </div>
  <div style="flex:1">
    <label for="oddMax">Odd mÃ¡xima:</label>
    <input id="oddMax" step="0.01" type="number" value="10.00"/>
  </div>
</div>

<button onclick="carregarOddsReais()">ðŸ”„ Carregar Odds Reais</button>
<input class="search-bar" id="filtro" placeholder="Filtrar por nome do time..." type="text"/>
<input class="search-bar" id="filtroCompeticao" placeholder="Filtrar por competiÃ§Ã£o ou data..." type="text"/>

<div class="button-group">
  <button onclick="selecionarTodos()">Selecionar Todos</button>
  <button onclick="limparSelecao()">Limpar SeleÃ§Ã£o</button>
  <button onclick="montarMelhorCombo()">ðŸŽ¯ Melhor Combo</button>
</div>

<div id="inputs"></div>

<label for="tipoDesdobramento">Tipo de aposta (acertos):</label>
<select id="tipoDesdobramento">
  <option value="1">1 (simples)</option><option value="2">2 (duplas)</option>
  <option value="3">3 (trios)</option><option value="4">4 (quartetos)</option>
  <option value="5">5 (quinas)</option><option value="6">6 (senas)</option>
  <option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
</select>

<input id="stake" placeholder="Valor por combinaÃ§Ã£o (R$)" step="0.01" type="number" value="10">
<button onclick="gerarDesdobramento()">Gerar L.A Cashback VIP ðŸ‘‘</button>

<div class="button-group">
  <button onclick="baixarTXT()">ðŸ“„ Baixar .txt</button>
  <button onclick="baixarPDF()">ðŸ“¥ Baixar PDF</button>
</div>

<div id="resultado"></div>

<script>
function gerarCombinacoes(array, k) {
  let res = [];
  function comb(start, combo) {
    if (combo.length === k) return res.push(combo);
    for (let i = start; i < array.length; i++) {
      comb(i + 1, combo.concat([array[i]]));
    }
  }
  comb(0, []);
  return res;
}

let ultimaCombinacao = [];

function gerarDesdobramento(combinacoesPersonalizadas = null) {
  const tipoDesdobramento = parseInt(document.getElementById("tipoDesdobramento").value);
  const stake = parseFloat(document.getElementById("stake").value);
  const checkboxes = document.querySelectorAll(".jogoCheck:checked");

  if (checkboxes.length < tipoDesdobramento && !combinacoesPersonalizadas) {
    alert(`VocÃª selecionou apenas ${checkboxes.length} jogos, mas escolheu um desdobramento de ${tipoDesdobramento}.`);
    return;
  }

  if (isNaN(stake) || stake <= 0) {
    alert("Insira valor de aposta vÃ¡lido.");
    return;
  }

  const jogos = combinacoesPersonalizadas || Array.from(checkboxes).map(cb => ({
    jogo: cb.dataset.nome,
    odd: parseFloat(cb.dataset.odd)
  }));

  const combinacoes = combinacoesPersonalizadas || gerarCombinacoes(jogos, tipoDesdobramento);
  ultimaCombinacao = combinacoes;

  let html = `<h3>CombinaÃ§Ãµes ${tipoDesdobramento} (${document.querySelector("#tipoAposta option:checked").textContent})</h3>`;
  let totalRetorno = 0;

  combinacoes.forEach((combo, i) => {
    const oddTotal = combo.reduce((acc, cur) => acc * cur.odd, 1);
    const retorno = stake * oddTotal;
    totalRetorno += retorno;

    const selecoes = combo.map(j => `- ${j.jogo.split(" - ")[1]} (${j.odd.toFixed(2)})`).join("<br>");

    html += `
      <div class="combo-card">
        <h4>Bilhete ${i + 1} - Odd Total: ${oddTotal.toFixed(2)}</h4>
        <p>${selecoes}</p>
        <div class="combo-retorno">Retorno: R$ ${retorno.toFixed(2)}</div>
      </div>`;
  });

  const totalApostado = (combinacoes.length * stake).toFixed(2);
  html += `
    <p><strong>Total de combinaÃ§Ãµes:</strong> ${combinacoes.length}</p>
    <p><strong>Total Apostado:</strong> R$ ${totalApostado}</p>
    <p style="color:green;"><strong>Retorno estimado se acertar todos:</strong> R$ ${totalRetorno.toFixed(2)}</p>`;

  document.getElementById("resultado").innerHTML = html;
}

async function carregarOddsReais() {
  const API_KEY = "69b92fb729838ba69139a6d92c457f83";
  const ligaSelecionada = document.getElementById("liga").value;
  const tipoSelecionado = document.getElementById("tipoAposta").value;
  const oddMin = parseFloat(document.getElementById("oddMin").value);
  const oddMax = parseFloat(document.getElementById("oddMax").value);

  const ligasMap = {
    soccer_brazil_campeonato: 71,
    soccer_epl: 39,
    soccer_uefa_champs_league: 2,
    soccer_copa_libertadores: 13
  };

  const mercadosMap = {
    simples: "Match Winner",
    btts: "Both Teams To Score",
    over25: "Over/Under 2.5",
    under25: "Over/Under 2.5",
    placar: "Correct Score",
    dupla: "Double Chance",
    resultado_gols: "Result / Total Goals",
    outros: ""
  };

  const leagueId = ligasMap[ligaSelecionada];
  const mercadoDesejado = mercadosMap[tipoSelecionado];
  const anoAtual = new Date().getFullYear();
  const cacheKey = `cache_${ligaSelecionada}_${tipoSelecionado}`;
  let jogos;

  const cache = localStorage.getItem(cacheKey);
  if (cache) {
    jogos = JSON.parse(cache);
    console.log("ðŸŸ¡ Usando cache local");
  } else {
    const response = await fetch(`https://v3.football.api-sports.io/odds?league=${leagueId}&season=${anoAtual}&bookmaker=1`, {
      headers: {
        "x-apisports-key": API_KEY
      }
    });
    const data = await response.json();
    jogos = data.response || [];
    localStorage.setItem(cacheKey, JSON.stringify(jogos));
    console.log("ðŸŸ¢ Dados carregados da API");
  }

  const container = document.getElementById("inputs");
  container.innerHTML = "";
  let totalExibidos = 0;

  jogos.forEach(entry => {
    const partida = entry.fixture;
    const times = `${entry.teams.home.name} vs ${entry.teams.away.name}`;
    const horario = new Date(partida.date).toLocaleString("pt-BR", {
      day: "2-digit", month: "2-digit", hour: "2-digit", minute: "2-digit"
    });

    let mercado = entry.bookmakers?.[0]?.bets?.find(b => b.name.toLowerCase().includes(mercadoDesejado.toLowerCase()));
    if (tipoSelecionado === "under25" && mercado) {
      mercado.values = mercado.values.filter(v => v.value === "Under 2.5");
    }
    if (tipoSelecionado === "over25" && mercado) {
      mercado.values = mercado.values.filter(v => v.value === "Over 2.5");
    }

    if (!mercado || !mercado.values) return;

    mercado.values.forEach(opt => {
      const odd = parseFloat(opt.odd || opt.odds);
      if (odd >= oddMin && odd <= oddMax) {
        const id = `jogo_${partida.id}_${opt.value}`;
        const label = `${times} - ${opt.value}`;

        const card = document.createElement("div");
        card.className = "game-card";

        card.innerHTML = `
          <div class="game-title">${times}</div>
          <div style="font-size: 0.9rem; color: #555;">ðŸ“… ${horario}</div>
          <div class="game-option">
            <input type="checkbox" class="jogoCheck" data-nome="${label}" data-odd="${odd}" id="${id}">
            <label for="${id}">${opt.value} - <strong>Odd:</strong> ${odd}</label>
          </div>
        `;

        container.appendChild(card);
        totalExibidos++;
      }
    });
  });

  if (totalExibidos === 0) {
    container.innerHTML = "<p>Nenhum jogo encontrado com odds dentro da faixa selecionada.</p>";
  }
}
</script>
</body>
</html>
