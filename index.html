
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>L.A Cashback VIP ðŸ‘‘</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7; margin: 0; }
    h2 { text-align: center; color: #333; }

    label, select, input {
      display: block; width: 100%; margin-bottom: 12px;
      font-size: 1rem; padding: 10px; border-radius: 5px;
      border: 1px solid #ccc; box-sizing: border-box;
    }

    button {
      width: 100%; padding: 14px; background-color: #007BFF;
      color: white; font-size: 1.1rem; border: none;
      border-radius: 8px; margin-top: 10px; cursor: pointer;
    }

    button:hover { background-color: #0056b3; }

    .game-card {
      background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 15px; margin-bottom: 15px;
    }

    .game-title {
      font-weight: bold; margin-bottom: 10px;
    }

    .game-option {
      margin-bottom: 6px;
      display: flex; align-items: center;
    }

    .game-option input {
      margin-right: 8px;
    }

    .icon {
      display: inline-block; width: 20px; text-align: center;
      margin-right: 6px;
    }

    .search-bar {
      margin-bottom: 15px;
      padding: 10px;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 100%;
      box-sizing: border-box;
    }

    .button-group {
      display: flex; gap: 10px; margin-bottom: 10px;
    }

    .combo-card {
      background: #fff; color: #000;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .combo-card h4 {
      margin: 0 0 8px 0;
      color: #007BFF;
      font-size: 1.1rem;
    }

    .combo-card p {
      margin: 4px 0;
      font-size: 1rem;
      line-height: 1.4;
    }

    .combo-retorno {
      font-weight: bold;
      color: green;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <h2>L.A Cashback VIP ðŸ‘‘</h2>

  <!-- Novas funcionalidades -->
  <label for="liga">Escolha a Liga:</label>
  <select id="liga">
    <option value="soccer_brazil_campeonato">BrasileirÃ£o</option>
    <option value="soccer_epl">Premier League</option>
    <option value="soccer_uefa_champs_league">Champions League</option>
    <option value="soccer_copa_libertadores">Libertadores</option>
  </select>

  <label for="tipoAposta">Modo de aposta:</label>
  <select id="tipoAposta">
    <option value="simples">Simples (1X2)</option>
    <option value="placar">Placar Exato</option>
    <option value="btts">Ambas Marcam (BTTS)</option>
    <option value="over25">Mais de 2.5 Gols</option>
    <option value="under25">Menos de 2.5 Gols</option>
    <option value="dupla">Dupla Chance</option>
    <option value="resultado_gols">Resultado + Gols</option>
  </select>

  <div style="display: flex; gap: 10px;">
    <div style="flex:1">
      <label for="oddMin">Odd mÃ­nima:</label>
      <input type="number" id="oddMin" step="0.01" value="1.10" />
    </div>
    <div style="flex:1">
      <label for="oddMax">Odd mÃ¡xima:</label>
      <input type="number" id="oddMax" step="0.01" value="10.00" />
    </div>
  </div>

  <button onclick="carregarOddsReais()">ðŸ”„ Carregar Odds Reais</button>

  <input type="text" id="filtro" class="search-bar" placeholder="Filtrar por nome do time...">
  <input type="text" id="filtroCompeticao" class="search-bar" placeholder="Filtrar por competiÃ§Ã£o ou data...">

  <div class="button-group">
    <button onclick="selecionarTodos()">Selecionar Todos</button>
    <button onclick="limparSelecao()">Limpar SeleÃ§Ã£o</button>
    <button onclick="montarMelhorCombo()">ðŸŽ¯ Melhor Combo</button>
  </div>

  <div id="inputs"></div>

  <label for="tipoDesdobramento">Tipo de aposta (acertos):</label>
  <select id="tipoDesdobramento">
    <option value="1">1 (simples)</option><option value="2">2 (duplas)</option>
    <option value="3">3 (trios)</option><option value="4">4 (quartetos)</option>
    <option value="5">5 (quinas)</option><option value="6">6 (senas)</option>
    <option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
  </select>

  <input type="number" step="0.01" placeholder="Valor por combinaÃ§Ã£o (R$)" id="stake" value="10" />

  <button onclick="gerarDesdobramento()">Gerar L.A Cashback VIP ðŸ‘‘</button>

  <div class="button-group">
    <button onclick="baixarTXT()">ðŸ“„ Baixar .txt</button>
    <button onclick="baixarPDF()">ðŸ“¥ Baixar PDF</button>
  </div>

  <div id="resultado"></div>

<script>
function gerarCombinacoes(array, k) {
  let res = [];
  function comb(start, combo) {
    if (combo.length === k) return res.push(combo);
    for (let i = start; i < array.length; i++) {
      comb(i + 1, combo.concat([array[i]]));
    }
  }
  comb(0, []);
  return res;
}

let ultimaCombinacao = [];

function gerarDesdobramento(combinacoesPersonalizadas = null) {
  const tipoDesdobramento = parseInt(document.getElementById("tipoDesdobramento").value);
  const stake = parseFloat(document.getElementById("stake").value);
  const checkboxes = document.querySelectorAll(".jogoCheck:checked");

  if (checkboxes.length < tipoDesdobramento && !combinacoesPersonalizadas) {
    alert(`VocÃª selecionou apenas ${checkboxes.length} jogos, mas escolheu um desdobramento de ${tipoDesdobramento}.`);
    return;
  }

  if (isNaN(stake) || stake <= 0) {
    alert("Insira valor de aposta vÃ¡lido.");
    return;
  }

  const jogos = combinacoesPersonalizadas || Array.from(checkboxes).map(cb => ({
    jogo: cb.dataset.nome,
    odd: parseFloat(cb.dataset.odd)
  }));

  const combinacoes = combinacoesPersonalizadas || gerarCombinacoes(jogos, tipoDesdobramento);
  ultimaCombinacao = combinacoes;

  let html = `<h3>CombinaÃ§Ãµes ${tipoDesdobramento} (${document.querySelector("#tipoAposta option:checked").textContent})</h3>`;
  let totalRetorno = 0;

  combinacoes.forEach((combo, i) => {
    const oddTotal = combo.reduce((acc, cur) => acc * cur.odd, 1);
    const retorno = stake * oddTotal;
    totalRetorno += retorno;

    const selecoes = combo.map(j => `- ${j.jogo.split(" - ")[1]} (${j.odd.toFixed(2)})`).join("<br>");

    html += `
      <div class="combo-card">
        <h4>Bilhete ${i + 1} - Odd Total: ${oddTotal.toFixed(2)}</h4>
        <p>${selecoes}</p>
        <div class="combo-retorno">Retorno: R$ ${retorno.toFixed(2)}</div>
      </div>`;
  });

  const totalApostado = (combinacoes.length * stake).toFixed(2);
  html += `
    <p><strong>Total de combinaÃ§Ãµes:</strong> ${combinacoes.length}</p>
    <p><strong>Total Apostado:</strong> R$ ${totalApostado}</p>
    <p style="color:green;"><strong>Retorno estimado se acertar todos:</strong> R$ ${totalRetorno.toFixed(2)}</p>`;

  document.getElementById("resultado").innerHTML = html;
}


async function carregarOddsReais() {
  const API_KEY = "d4d52d8e8d186ecee91808ff600dcd63";
  const liga = document.getElementById("liga").value;
  const tipoAposta = document.getElementById("tipoAposta").value;
  const oddMin = parseFloat(document.getElementById("oddMin").value) || 1.10;
  const oddMax = parseFloat(document.getElementById("oddMax").value) || 10.00;
  const inputs = document.getElementById("inputs");

  let market = "h2h";
  if (tipoAposta === "over25" || tipoAposta === "under25") market = "totals";
  else if (tipoAposta === "btts") market = "btts";
  else if (tipoAposta === "placar") market = "correct_score";
  else if (tipoAposta === "dupla") market = "double_chance";
  else if (tipoAposta === "resultado_gols") market = "match_winner_and_totals";

  const url = `https://api.the-odds-api.com/v4/sports/${liga}/odds/?regions=us&markets=${market}&oddsFormat=decimal&apiKey=${API_KEY}`;

  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error("Erro na resposta da API");

    const data = await response.json();
    inputs.innerHTML = "";
    let jogoCount = 0;

    data.forEach(jogo => {
      const mercado = jogo?.bookmakers?.[0]?.markets?.[0];
      if (!mercado || mercado.outcomes.length === 0) return;

      let bloco = '';
      let adicionou = false;

      mercado.outcomes.forEach(outcome => {
        let nomeExibicao = outcome.name;
        let icon = "ðŸŽ¯";

        if (market === "totals") {
          const isOver = outcome.name.includes("Over");
          const valorGols = parseFloat(outcome.name.split(" ")[1]);
          if ((tipoAposta === "over25" && isOver && valorGols === 2.5) ||
              (tipoAposta === "under25" && !isOver && valorGols === 2.5)) {
            if (outcome.price >= oddMin && outcome.price <= oddMax) {
              adicionou = true;
              bloco += `<div class="game-option">
                <input type="checkbox" class="jogoCheck"
                       data-nome="${jogo.home_team} vs ${jogo.away_team} - ${outcome.name}"
                       data-odd="${outcome.price.toFixed(2)}" />
                <span class="icon">${icon}</span> ${outcome.name} @ ${outcome.price.toFixed(2)}
              </div>`;
            }
          }
        } else if (market === "btts") {
          if (tipoAposta === "btts" && outcome.name === "Yes" &&
              outcome.price >= oddMin && outcome.price <= oddMax) {
            adicionou = true;
            bloco += `<div class="game-option">
              <input type="checkbox" class="jogoCheck"
                     data-nome="${jogo.home_team} vs ${jogo.away_team} - Ambas Marcam (Sim)"
                     data-odd="${outcome.price.toFixed(2)}" />
              <span class="icon">${icon}</span> Sim @ ${outcome.price.toFixed(2)}
            </div>`;
          }
        } else {
          if (outcome.price >= oddMin && outcome.price <= oddMax) {
            adicionou = true;
            bloco += `<div class="game-option">
              <input type="checkbox" class="jogoCheck"
                     data-nome="${jogo.home_team} vs ${jogo.away_team} - ${outcome.name}"
                     data-odd="${outcome.price.toFixed(2)}" />
              <span class="icon">${icon}</span> ${outcome.name} @ ${outcome.price.toFixed(2)}
            </div>`;
          }
        }
      });

      if (adicionou) {
        jogoCount++;
        inputs.innerHTML += `<div class="game-card" data-times="${jogo.home_team.toLowerCase()} ${jogo.away_team.toLowerCase()}" data-competicao="${jogo.commence_time}">
          <div class="game-title">${jogo.home_team} vs ${jogo.away_team}</div>
          ${bloco}
        </div>`;
      }
    });

    if (jogoCount === 0) {
      inputs.innerHTML += "<p style='color:red;'>Nenhuma odd encontrada no intervalo definido para esse tipo de aposta.</p>";
    } else {
      alert("Selecione os resultados desejados para apostar.");
    }

  } catch (err) {
    console.error("Erro ao buscar odds reais:", err);
    alert("Erro ao buscar odds. Tente novamente mais tarde.");
  }
}


function selecionarTodos() {
  document.querySelectorAll(".jogoCheck").forEach(cb => cb.checked = true);
}

function limparSelecao() {
  document.querySelectorAll(".jogoCheck").forEach(cb => cb.checked = false);
}

function baixarTXT() {
  let texto = document.getElementById("resultado").innerText;
  let blob = new Blob([texto], { type: "text/plain" });
  let link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "bilhetes.txt";
  link.click();
}

function baixarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let texto = document.getElementById("resultado").innerText.split("\n");
  let y = 10;
  texto.forEach(linha => {
    if (y > 280) { doc.addPage(); y = 10; }
    doc.text(linha, 10, y);
    y += 7;
  });
  doc.save("bilhetes.pdf");
}

function montarMelhorCombo() {
  const checkboxes = Array.from(document.querySelectorAll(".jogoCheck"));
  const tipoDesdobramento = parseInt(document.getElementById("tipoDesdobramento").value);
  const stake = parseFloat(document.getElementById("stake").value);
  if (checkboxes.length < tipoDesdobramento) {
    alert("NÃ£o hÃ¡ jogos suficientes selecionÃ¡veis para esse combo.");
    return;
  }
  const jogos = checkboxes.map(cb => ({
    jogo: cb.dataset.nome,
    odd: parseFloat(cb.dataset.odd)
  }));

  const melhores = jogos.sort((a, b) => b.odd - a.odd).slice(0, tipoDesdobramento);
  gerarDesdobramento([melhores]);
}

document.getElementById("filtro").addEventListener("input", function () {
  const termo = this.value.toLowerCase();
  document.querySelectorAll(".game-card").forEach(card => {
    card.style.display = card.dataset.times.includes(termo) ? "block" : "none";
  });
});

document.getElementById("filtroCompeticao").addEventListener("input", function () {
  const termo = this.value.toLowerCase();
  document.querySelectorAll(".game-card").forEach(card => {
    card.style.display = card.dataset.competicao.includes(termo) ? "block" : "none";
  });
});
</script>
</body>
</html>
